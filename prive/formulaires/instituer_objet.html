<div class="instituer_objet">
	[(#REM) Dans tous les cas on commence par afficher le statut actuel ]
	<div class="statut_old">
		<strong class="label">Statut [(#ENV{_aide}|oui)#AIDER{#ENV{_aide}}]</strong>
		<div class="statut">
			[(#ENV{statut}|puce_statut{#ENV{_objet}})]
			[(#ENV{_statuts}|table_valeur{#ENV{statut}}|_T)]
		</div>
	</div>
	
	[(#ENV{_publiable}|non|et{#ENV{statut}|=={prepa}|oui})
	<p class="small"><:texte_proposer_publication:></p>
	]
	[(#ENV{editable}|oui)
	<div class="formulaire_spip formulaire_editer formulaire_instituer[ formulaire_#FORM formulaire_#FORM-(#ENV{_objet})][ formulaire_#FORM-#ENV{_objet}-(#ENV{_id_objet})]">
		[<p class="reponse_formulaire reponse_formulaire_ok" role="status">(#ENV**{message_ok})</p>]
		[<p class="reponse_formulaire reponse_formulaire_erreur" role="alert">(#ENV*{message_erreur})</p>]
		<form method='post' action='#ENV{action}'><div>
			[(#REM) declarer les hidden qui declencheront le service du formulaire
			parametre : url d'action ]
			#ACTION_FORMULAIRE
			
			#SET{name,statut}#SET{obli,'obligatoire'}#SET{erreurs,#ENV**{erreurs}|table_valeur{#GET{name}}}
			<div class="editer-groupe">
				<div class="editer editer_[(#GET{name})] statut_#ENV{#GET{name}}[ (#GET{obli})][ (#GET{erreurs}|oui)erreur]">
					[<span class='erreur_message'>(#GET{erreurs})</span>]
					<fieldset class="editer">
						<legend>Choix du statut</legend>
						<BOUCLE_choix(DATA){source table, #ENV{_statuts}}{cle != #ENV{statut}}>
						<div class="choix">
							<input
								type="radio" class="radio"
								name="#GET{name}"
								id="instituer_#ENV{_objet}_#ENV{_id_objet}_choix_#CLE"
								[(#ENV{#GET{name}}|=={#CLE}|oui)selected="selected"]
								value="#CLE"
							/>
							<label for="instituer_#ENV{_objet}_#ENV{_id_objet}_choix_#CLE">
								[(#CLE|puce_statut{#ENV{_objet}})]
								[(#VALEUR|_T)]
							</label>
						</div>
						</BOUCLE_choix>
					</fieldset>
				</div>
			</div>
			<!--extra-->
			<p class='boutons'><span class='image_loading'>&nbsp;</span>
				<input type='submit' class='btn submit' value='<:bouton_changer:>' /></p>
		</div></form>
	</div>
	]
</div>

<script type="text/javascript">
	//~ function update_select(statut_default){
		//~ var selected = this.options[this.selectedIndex];
		//~ var boutons = jQuery(this).attr('style',jQuery(selected).attr('style')).closest('form').find('.boutons');
		//~ if (selected.value!=statut_default)
			//~ boutons.css('visibility','visible').show('fast');
		//~ else
			//~ boutons.css('visibility','hidden')
	//~ }
	//~ jQuery(function($){
		//~ $(".formulaire_#FORM .show select")
			//~ .each(function(){update_select.apply(this,['#ENV{#GET{name}}']);})
			//~ .on('change',function(){update_select.apply(this,['#ENV{#GET{name}}']);})
			//~ .on('keyup',function(){update_select.apply(this,['#ENV{#GET{name}}']);});
	//~ });
	;(function($){
		[(#REM) Seulement si éditable et que sans erreur, on masque le form par défaut ]
		[(#ENV**{erreurs}|non|et{#ENV{editable}})
			var form = $('.formulaire_#FORM-#ENV{_objet}-#ENV{_id_objet}');
			
			// On masque au départ le form pour modifier
			form.toggleClass('none-js');
			
			// Un bouton pour afficher le form pour modifier
			var bouton_modifier = $('<button class="btn_mini btn_secondaire float-end" aria-expanded="false">Changer</button>')
				.click(function() {
					form.slideDown().removeClass('none-js');
					$(this).slideUp().attr('aria-expanded', 'true');
				});
			
			// On ajoute ce bouton dynamiquement
			$('.instituer_objet .statut_old .label').after(bouton_modifier);
			
			// Un bouton Annuler
			var bouton_annuler = $('<button class="btn_secondaire"><:bouton_annuler:></button>')
				.click(function() {
					form.slideUp().addClass('none-js');
					bouton_modifier.slideDown().attr('aria-expanded', 'false');
					return false;
				});
			
			// On ajoute ce bouton à l'intérieur du form
			form.find('.boutons \[type=submit\]').wrap('<div class="groupe-btns"></div>').parent().prepend(bouton_annuler);
		]
	})(jQuery);
</script>
